{% extends "layout.html" %}
{% block body %}
<script src="{{ url_for('static', filename='js/data_import.js') }}"></script>
<script src="{{ url_for('static', filename='js_libraries/FileSaver.js') }}"></script>


<div id="accordion">
  <div class="card">
    <div class="card-header" id="help_header">
      <h5>
        <button class="btn btn-link" data-toggle="collapse" data-target="#instructions"
          {% if plot_series %} area-expanded="true" {% endif %}>Instructions</button>
      </h5>
    </div>
    <div id="instructions" class="collapse show" area-labelledby="help_header" data-parent="#accordion">
      <div class="card-body">
        <div class="alert alert-danger mt-2" role="alert">
          PLEASE read the following instructions before you start importing the data
        </div>
        <div class="alert alert-secondary" role="alert">
          <p>1. Please make sure that data you are trying to import has required format.</p>
          <p>2. If you are in doubt, please take a look at the <b>example files</b> (see below).
            Note, that these files contain fake data, all values were generated by <b>random()</b> function. </b>
            So please DO NOT IMPORT them after downloading. It's just for you to have a look and see what it should look like.</p>
          <p>3. Make sure your file has <b>header</b>.</p>
          <p>4. The header must contain <b>at least</b> the columns which are in the example files</p>
          <p>5. The order of columns <b>does not</b> matter. If you have more columns in your file, this is also fine. </p>
          <p>6. The columns <b>must</b> be separated by <b>tab</b>, not spaces, not commas, etc</p>
          <p>7. It is highly <b>not recommended</b> to flush database. If you are deleting everything, make sure <b>beforehand</b>
            that you will be able to restore the data (means you have <b>exaclty the same files</b> which were uploaded previously)</p>
          <p>8. Import of <b>fold change and pvalues</b> takes relatively short time (some minutes maybe), where import of
            normalized counts can take significantly <b>longer</b> (be ready to wait 2 hours).</p>
          <p>9. After you pressed <b>Update Database</b> button, please <b>DO NOT</b> close the browser,
            <b>DO NOT</b> reload the page, <b>DO NOT</b> click any buttons. Just <b>wait</b> until you see a green message
            (if import was successfuly) or a red message (if import has failed)</b></p>
          <p>10. If the import has failed, this DID NOT affect any data which has already been imported before. It only means that the new data has not been imported. Try again, but do not flush database.</p>
        </div>
        <ul class="list-group border-primary">
          <li class="list-group-item">Example of file with <b>fold change and pvalues</b> (WITHOUT drugs):
              <a class="link link-secondary download_example" href="#" onclick='return false'
                 id="fc_pval_without_drugs">Download file</a>
          </li>
          <li class="list-group-item">Example of file with <b>fold change and pvalues</b> (WITH drugs):
              <a class="link link-secondary download_example" id="fc_pval_with_drugs" href="#"
                 onclick='return false'>Download file</a></li>
        </ul>
        <ul class="list-group mt-2  ">
          <li class="list-group-item">Example of file with <b>normalized counts</b> (WITHOUT drugs):
              <a class="link link-secondary download_example" href="#"onclick='return false'
                 id="norm_counts_without_drugs">Download file</a></li>
          <li class="list-group-item">Example of file with <b>normalized counts</b> (WITH drugs):
              <a class="link link-secondary download_example" onclick='return false'
                 href="#" id="norm_counts_with_drugs">Download file</a></li>
        </ul>
      </div>
    </div>
    <div class="card-header" id="import_header">
      <h5>
        <button class="btn btn-link" data-toggle="collapse" data-target="#data_import"
          {% if not plot_series %} aria-expanded="true" {% endif %}>Import Data</button>
      </h5>
    </div>
    <div id="data_import" class="collapse" area-labelledby="import_header" data-parent="#accordion">
      <div class="card-body">

        <form action="" method="POST" enctype="multipart/form-data" id="import_form">
          <label for="data_type">What do you want to import?</label>
          <select name="data_type" class="custom-select mb-2" id="data_type">
            <option value="fold_changes" {% if selected_data_type=="fold_changes" %}selected{% endif %}>Fold change and p values</option>
            <option value="norm_counts" {% if selected_data_type=="norm_counts" %}selected{% endif %}>Normalized counts</option>
            <option value="flush_db" {% if selected_data_type=="flush_db" %} selected {% endif %}>Flush database - WARNING: This will delete ALL data!!</option>
          </select>

          <label for="with_drugs">With drugs or without drugs?</label>
          <select name="with_drugs" class="custom-select mb-2" id="with_drugs">
            <option name="with_drugs" {% if with_drugs=="with_drugs" %} selected {% endif %} value="with_drugs">With drugs</option>
            <option name="without_drugs" {% if with_drugs=="without_drugs" %} selected {% endif %} value="without_drugs">Without drugs</option>
          </select>

          <div class="custom-file">
            <input type="file" class="custom-file-input" id="input_file" name="input_file">
            <label class="custom-file-label" for="input_file">Select file</label>
          </div>

          <button class="btn btn-outline-info mt-2" type="submit">Update database</button>

          {% if error %}
          <div class="alert alert-danger mt-2" role="alert">
            <div class="row">
              <div class="col col-xs-10">{{ error }}</div>
              <div class="col col-sm-2"><span class="close" aria-label="Close"> &times;</span></div>
            </div>
          </div>
          {% endif %}
          {% if success %}
          <div class="alert alert-success mt-2" role="alert">
            <div class="row">
              <div class="col col-xs-10">{{ success }}</div>
              <div class="col col-sm-2"><span class="close" aria-label="Close"> &times;</span></div>
            </div>
          </div>
          {% endif %}
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}